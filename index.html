<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÅ –í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤ - –°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π</title>

    <style>
        /* –í–ê–® –í–ï–°–¨ CSS –ö–û–î –°–ö–û–ü–ò–†–£–ô–¢–ï –°–Æ–î–ê –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: var(--gradient);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: 'üéÅ';
            position: absolute;
            font-size: 300px;
            opacity: 0.1;
            top: -100px;
            right: -50px;
            transform: rotate(15deg);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* ... –û–°–¢–ê–õ–¨–ù–û–ô –í–ê–® CSS –ö–û–î ... */
        /* –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–ï–°–¨ –≤–∞—à CSS –æ—Ç—Å—é–¥–∞ –¥–æ —Ç–µ–≥–∞ </style> */
    </style>
</head>
<body>
    <!-- –í–ê–® HTML –ö–û–î –û–°–¢–ê–ï–¢–°–Ø –¢–ê–ö–ò–ú –ñ–ï -->
    <div class="container">
        <div class="header">
            <h1>üéÅ –°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏–µ –ú–∞–∫—Å–∏–º–∞!</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –æ–Ω –∏—Å—á–µ–∑–Ω–µ—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>
        </div>

        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h3>
            <ol>
                <li>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–∏–∂–µ</li>
                <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ OZON</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è –ø–æ–¥–∞—Ä–æ–∫ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É —Å–ø—Ä–∞–≤–∞</li>
                <li>–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–∞—Ä–æ–∫ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ "–ó–∞–Ω—è—Ç" –∏ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö</li>
                <li>–ö–∞–∂–¥—ã–π –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ–¥–∞—Ä–æ–∫</li>
            </ol>
        </div>

        <div class="content">
            <div class="gifts-section">
                <h2 style="color: var(--primary); margin-bottom: 20px;">
                    <i class="fas fa-gifts"></i> –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏
                </h2>

                <div id="gifts-container">
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤...</p>
                    </div>
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                        <h3 id="total-gifts">0</h3>
                        <p><i class="fas fa-gift"></i> –í—Å–µ–≥–æ –ø–æ–¥–∞—Ä–∫–æ–≤</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="taken-gifts">0</h3>
                        <p><i class="fas fa-check-circle"></i> –í—ã–±—Ä–∞–Ω–æ</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="available-gifts">0</h3>
                        <p><i class="fas fa-clock"></i> –î–æ—Å—Ç—É–ø–Ω–æ</p>
                    </div>
                </div>

                <div id="message" class="message"></div>
            </div>

            <div class="selection-form">
                <h2 class="form-title"><i class="fas fa-hand-pointer"></i> –í—ã–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫</h2>

                <div class="form-group">
                    <label for="userName"><i class="fas fa-user"></i> –í–∞—à–µ –∏–º—è:</label>
                    <input type="text" id="userName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
                </div>

                <div class="form-group">
                    <label for="userEmail"><i class="fas fa-envelope"></i> –í–∞—à email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                    <input type="email" id="userEmail" placeholder="email@example.com">
                </div>

                <div class="form-group">
                    <label for="giftSelect"><i class="fas fa-gift"></i> –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫:</label>
                    <select id="giftSelect" class="gift-select" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ --</option>
                    </select>
                </div>

                <button class="submit-btn" onclick="selectGift()">
                    <i class="fas fa-check-circle"></i> –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫
                </button>

                <div class="admin-panel">
                    <h4><i class="fas fa-lock"></i> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
                    <p style="margin-bottom: 15px; color: var(--gray); font-size: 0.9rem;">
                        –ü–∞—Ä–æ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: <code>admin123</code>
                    </p>

                    <div class="admin-input">
                        <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        <button class="admin-btn" onclick="resetAllGifts()">
                            <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ
                        </button>
                    </div>

                    <div class="admin-input">
                        <input type="text" id="newGiftName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞">
                        <button class="admin-btn" onclick="addNewGift()" style="background: var(--primary);">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                    <div class="admin-input">
                        <input type="text" id="newGiftUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ OZON">
                    </div>
                    <div class="admin-input">
                        <input type="text" id="newGiftDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞">
                    </div>
                </div>

                <div class="share-link">
                    <input type="text" id="shareUrl" readonly value="–ó–∞–≥—Ä—É–∑–∫–∞...">
                    <button class="copy-btn" onclick="copyShareLink()">
                        <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <p>üéÑ –°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –ú–∞–∫—Å–∏–º–∞</p>
            <p>–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ GitHub ‚Ä¢ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
        </footer>
    </div>

    <button class="refresh-btn" onclick="loadGifts()" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫">
        <i class="fas fa-sync-alt"></i>
    </button>

    <script>
// ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø GITHUB API =====
const GITHUB_CONFIG = {
    owner: 'dimetris-93',
    repo: 'gifts-list-data',
    path: 'gifts.json',
    token: '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', // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô –¢–û–ö–ï–ù!
    branch: 'main'
};

// ===== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

// 1. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è base64
function encodeBase64(str) {
    try {
        return btoa(unescape(encodeURIComponent(str)));
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
        return btoa(str);
    }
}

// 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è base64
function decodeBase64(str) {
    try {
        return decodeURIComponent(escape(atob(str)));
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
        return JSON.parse(atob(str));
    }
}

// 3. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å GitHub (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è)
async function loadGiftsFromGitHub() {
    try {
        showLoading(true);
        
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`;
        
        console.log('–ó–∞–ø—Ä–æ—Å –∫:', url);
        
        const response = await fetch(url, {
            headers: {
                'Authorization': `token ${GITHUB_CONFIG.token}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });
        
        console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏:', errorText);
            
            if (response.status === 404) {
                throw new Error('–§–∞–π–ª gifts.json –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏');
            } else if (response.status === 401) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π GitHub Token');
            } else if (response.status === 403) {
                throw new Error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞');
            } else {
                throw new Error(`GitHub API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${response.status}`);
            }
        }
        
        const data = await response.json();
        console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç GitHub:', data);
        
        currentFileSha = data.sha;
        
        // –î–µ–∫–æ–¥–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        let content;
        try {
            content = decodeBase64(data.content);
        } catch (e) {
            // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
            content = JSON.parse(atob(data.content));
        }
        
        console.log('–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:', content);
        
        gifts = content.gifts || [];
        
        if (gifts.length === 0) {
            console.warn('–°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –ø—É—Å—Ç!');
        }
        
        displayGifts();
        updateStats();
        updateShareLink();
        
        showMessage('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å GitHub!', 'success');
        
    } catch (error) {
        console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
        
        let errorMessage = `–û—à–∏–±–∫–∞: ${error.message}`;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        if (!GITHUB_CONFIG.token || GITHUB_CONFIG.token.includes('–í–ê–®_GITHUB_TOKEN')) {
            errorMessage = '‚ùå –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à GitHub Token –≤ –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ ~840)';
        } else if (error.message.includes('404')) {
            errorMessage = '‚ùå –§–∞–π–ª gifts.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏';
        } else if (error.message.includes('401') || error.message.includes('403')) {
            errorMessage = '‚ùå –û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Token';
        }
        
        showMessage(errorMessage, 'error');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        document.getElementById('gifts-container').innerHTML = `
            <div class="empty-state">
                <i class="fas fa-bug"></i>
                <p>${errorMessage}</p>
                <div style="margin-top: 20px; font-size: 0.9rem; color: var(--gray);">
                    <p><strong>–î–ª—è –æ—Ç–ª–∞–¥–∫–∏:</strong></p>
                    <p>1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console</p>
                    <p>2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö</p>
                    <p>3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª gifts.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
                    <p>4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Token</p>
                </div>
            </div>
        `;
    } finally {
        showLoading(false);
    }
}

// 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ)
async function updateGiftsOnGitHub(updatedGifts, commitMessage) {
    try {
        const contentData = {
            gifts: updatedGifts,
            lastUpdated: new Date().toISOString()
        };
        
        const jsonString = JSON.stringify(contentData, null, 2);
        const contentBase64 = encodeBase64(jsonString);
        
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`;
        
        const response = await fetch(url, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${GITHUB_CONFIG.token}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: commitMessage,
                content: contentBase64,
                sha: currentFileSha,
                branch: GITHUB_CONFIG.branch
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', errorData);
            throw new Error(errorData.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
        
        const result = await response.json();
        currentFileSha = result.content.sha;
        
        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ GitHub');
        return true;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
        showMessage(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
        return false;
    }
}
    </script>
</body>
</html>
